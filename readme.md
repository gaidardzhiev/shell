# Simple Shell Interpreter (`shell.c`)

This is a minimalist shell interpreter written in C designed to execute `*nix` shell commands interactively or from scripts. It supports basic features such as variable expansion, command execution, conditional expressions with `[ ... ]`, command chaining (`&&`, `||`, `;`), built in commands (`cd`, `exit`, `export`), and simple input/output redirection.

---

## Table of Contents

- [Features](#features)
- [Code Structure](#code-structure)
- [Detailed Explanation](#detailed-explanation)
  - [Signal Handling](#signal-handling)
  - [Tokenizer (`tkz`)](#tokenizer-tkz)
  - [Variable Expansion (`exp_vars`)](#variable-expansion-exp_vars)
  - [Built In Commands (`bltin`)](#built-in-commands-bltin)
  - [Redirection Parsing (`redir_parse`)](#redirection-parsing-redir_parse)
  - [Condition Evaluation (`eval_cond`)](#condition-evaluation-eval_cond)
  - [Command Execution (`exec_cmd`)](#command-execution-exec_cmd)
  - [Command Line Execution (`exec_line`)](#command-line-execution-exec_line)
  - [Main Loop](#main-loop)
- [Usage](#usage)

---

## Features

- **Tokenizer:** Parses input lines into tokens respecting quotes, escape characters, and shell special characters.
- **Variable Expansion:** Expands environment variables denoted by `$VAR`.
- **Built-ins:** Supports `cd`, `exit`, and `export` shell built in commands.
- **Redirections:** Handles single and double redirections like `>`, `>>`, and `<`.
- **Conditional Commands:** Supports POSIX test conditions wrapped in `[ ... ]`.
- **Chaining:** Supports command chaining with `;`, `&&`, and `||` operators.
- **Signal Handling:** Handles `SIGINT` (Ctrl+C) gracefully to avoid shell exit.
- **Prompt:** Displays a colorized user and current working directory prompt.

---

## Code Structure

The code is modular, composed of functions responsible for different key tasks:

| Function Name   | Responsibility                                          |
|-----------------|---------------------------------------------------------|
| `sigint_hdlr`   | Handles Ctrl+C interrupts to stay in shell             |
| `tkz`           | Tokenizes an input line to individual tokens            |
| `exp_vars`      | Expands environment variables within tokens             |
| `bltin`         | Implements built in commands (`cd`, `exit`, `export`)   |
| `redir_parse`   | Parses I/O redirections from tokens                      |
| `eval_cond`     | Evaluates shell test conditions (`[ ... ]`)              |
| `exec_cmd`      | Executes a command, fork/exec style with redirection     |
| `exec_line`     | Handles command chaining and condition evaluation       |
| `main`          | The interactive loop reading lines and driving execution |

---

## Detailed Explanation

### Signal Handling

```
void sigint_hdlr(int sig) {
    (void)sig;
    int_flag = 1;
    write(STDOUT_FILENO, "\n", 1);
}
```


- Installs a handler for `SIGINT` (generated by Ctrl+C).
- Sets a flag and prints a newline instead of exiting immediately.
- Allows the shell to return gracefully to prompt on interrupt.

---

### Tokenizer (`tkz`)

```
char **tkz(const char *ln, int *cnt)
```

- Splits input line `ln` into tokens, handling:
  - Quotes (`'...'`, `"..."`) allowing spaces and escapes inside.
  - Escaped characters with backslash (`\`).
  - Special shell characters as separate tokens (`>`, `<`, `;`, `|`, `&`, `]`).
- Skips empty tokens and leading/trailing whitespace for robustness.
- Returns array of tokens with count `cnt`.
- Dynamically allocates memory for tokens.

---

### Variable Expansion (`exp_vars`)

```
char *exp_vars(const char *tk)
```

- Scans input token for `$VAR` style environment variables.
- Replaces `$VAR` with the value from environment if it exists.
- Supports multiple variables in one token.
- Returns a new allocated string with expansions applied.

---

### Built-in Commands (`bltin`)

```
int bltin(char **a, int c)
```

- Recognizes and executes built-ins:
  - `cd [dir]`: Changes current directory (default home).
  - `exit`: Exits shell process.
  - `export VAR=VAL`: Sets environment variables.
- Returns 1 if command handled internally to prevent fork.

---

### Redirection Parsing (`redir_parse`)

```
int redir_parse(char **a, int *c, int *infd, int *outfd, int *app)
```

- Parses and handles input `<`, output `>`, and append `>>` redirection tokens.
- Opens files accordingly, managing file descriptors.
- Removes redirection tokens from argument list.
- Updates stdin/stdout file descriptors for command execution.

---

### Condition Evaluation (`eval_cond`)

```
int eval_cond(int c, char **a)
```

- Evaluates `[ ... ]` shell test expressions.
- Supports:
  - String length checks: `-n`, `-z`.
  - File tests: `-e` (exists), `-f` (regular file), `-d` (directory).
  - Integer comparison: `-eq`, `-ne`, `-gt`, `-ge`, `-lt`, `-le`.
  - String equality: `=`, `==`, `!=`
- Returns 0 for true (success), 1 for false (failure).
- Validates correct syntax and reports errors.

---

### Command Execution (`exec_cmd`)

```
int exec_cmd(char **a, int c)
```

- Executes commands not handled by built-ins.
- Forks a child process.
- Applies input/output redirections.
- Calls `execvp()` to start external command.
- Parent waits for child and returns exit status.

---

### Command Line Execution (`exec_line`)

```
int exec_line(char **a, int c)
```

- Handles command sequences connected by `;`, `&&`, and `||`.
- Splits tokens into command segments by these operators.
- Evaluates `[ ... ]` tests before running commands.
- Implements short-circuit logic for `&&` and `||`.

---

### Main Loop

```
int main(void)
```
- Installs signal handlers.
- Displays a colorized prompt with username and current working directory.
- Reads lines interactively using `getline()`.
- Tokenizes and expands variables on each line.
- Executes commands including conditionals and chaining.
- Loops infinitely until EOF or `exit` is issued.

---

## Usage

- Compile with:

```
make
```

- Run interactively:

```
./shell
```

- Run a script:

```
./shell < test.sh
```

